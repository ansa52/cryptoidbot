name: Publish

on:
  schedule:
    - cron: '25,50 * * * *'  # twice every hour.

jobs:
  publish-data:
    runs-on: macOS-latest
    env:
      CRYPTO_MONGO_CON: ${{ secrets.CRYPTO_MONGO_CON }}
      CRYPTO_MONGO_COL: ${{ secrets.CRYPTO_MONGO_COL }}
      CRYPTO_MONGO_DB: ${{ secrets.CRYPTO_MONGO_DB }}
      CRYPTO_APP: ${{ secrets.CRYPTO_APP }}
      CRYPTO_CONSUMER_API_KEY: ${{ secrets.CRYPTO_CONSUMER_API_KEY }}
      CRYPTO_CONSUMER_API_SECRET: ${{ secrets.CRYPTO_CONSUMER_API_SECRET }}
      CRYPTO_ACCESS_TOKEN: ${{ secrets.CRYPTO_ACCESS_TOKEN }}
      CRYPTO_ACCESS_TOKEN_SECRET: ${{ secrets.CRYPTO_ACCESS_TOKEN_SECRET }}
    steps:
      - uses: actions/checkout@v2
      - name: Install rtweet package
        run: Rscript -e 'install.packages("rtweet", dependencies = TRUE)'
      - name: Install tidyverse package
        run: Rscript -e 'install.packages("tidyverse", dependencies = TRUE)'
      - name: Install mongolite package
        run: Rscript -e 'install.packages("mongolite", dependencies = TRUE)'
      - name: Install gt package
        run: Rscript -e 'install.packages("gt", dependencies = TRUE)'
      - name: Install gtExtras package
        run: Rscript -e 'install.packages("gtExtras", dependencies = TRUE)'
      - name: Install webshot2 package
        run: Rscript -e 'install.packages("webshot2", dependencies = TRUE)'
      - name: Running rscript
        run: Rscript publish.R
